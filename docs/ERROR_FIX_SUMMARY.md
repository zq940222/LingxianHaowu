# ğŸ”§ é”™è¯¯ä¿®å¤æ€»ç»“

## å·²ä¿®å¤çš„é—®é¢˜

### 1. ModuleNotFoundError: No module named 'asyncpg'

**é—®é¢˜**:
```
ModuleNotFoundError: No module named 'asyncpg'
```

**åŸå› **: PostgreSQLå¼‚æ­¥é©±åŠ¨æœªå®‰è£…

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨ `backend/requirements.txt` ä¸­æ·»åŠ  `asyncpg==0.29.0`
- è¿è¡Œ `fix-backend.bat` è‡ªåŠ¨å®‰è£…

**æ–‡ä»¶æ›´æ–°**:
- âœ… `backend/requirements.txt` - æ·»åŠ asyncpg

---

### 2. NameError: name 'relationship' is not defined

**é—®é¢˜**:
```
NameError: name 'relationship' is not defined
```

**åŸå› **: `backend/app/models/merchant.py` ç¼ºå°‘SQLAlchemyçš„`relationship`å¯¼å…¥

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨ `merchant.py` ä¸­æ·»åŠ å¯¼å…¥: `from sqlalchemy.orm import relationship`

**æ–‡ä»¶æ›´æ–°**:
- âœ… `backend/app/models/merchant.py` - æ·»åŠ relationshipå¯¼å…¥

**ä»£ç ä¿®æ”¹**:
```python
# ä¹‹å‰
from sqlalchemy import Column, String, Integer, Text, DECIMAL

# ä¹‹å
from sqlalchemy import Column, String, Integer, Text, DECIMAL
from sqlalchemy.orm import relationship
```

---

## æ–°å¢çš„å·¥å…·å’Œè„šæœ¬

### 1. éªŒè¯è„šæœ¬

**scripts/verify-imports.py**
- æ£€æŸ¥Pythonç‰ˆæœ¬
- éªŒè¯æ‰€æœ‰æ ¸å¿ƒä¾èµ–ï¼ˆFastAPIã€SQLAlchemyã€asyncpgã€redisã€minioï¼‰
- éªŒè¯æ‰€æœ‰æ¨¡å‹å¯¼å…¥
- éªŒè¯æœåŠ¡å¯¼å…¥
- éªŒè¯APIè·¯ç”±
- éªŒè¯é…ç½®åŠ è½½
- éªŒè¯ä¸»åº”ç”¨

**ä½¿ç”¨æ–¹æ³•**:
```bash
python scripts/verify-imports.py
```

**è¾“å‡ºç¤ºä¾‹**:
```
============================================================
åç«¯å¯¼å…¥éªŒè¯
============================================================

[1/7] æ£€æŸ¥Pythonç‰ˆæœ¬...
  âœ“ Python 3.10.0

[2/7] æ£€æŸ¥æ ¸å¿ƒä¾èµ–...
  âœ“ FastAPI 0.104.1
  âœ“ SQLAlchemy 2.0.23
  âœ“ asyncpg (PostgreSQLå¼‚æ­¥é©±åŠ¨)
  âœ“ redis (Rediså®¢æˆ·ç«¯)
  âœ“ minio (MinIOå®¢æˆ·ç«¯)

[3/7] æ£€æŸ¥æ¨¡å‹å¯¼å…¥...
  âœ“ Merchantæ¨¡å‹
  âœ“ Useræ¨¡å‹
  âœ“ Productå’ŒCategoryæ¨¡å‹
  âœ“ Orderå’ŒOrderItemæ¨¡å‹
  âœ“ Paymentæ¨¡å‹

[4/7] æ£€æŸ¥æœåŠ¡å¯¼å…¥...
  âœ“ MinIOå­˜å‚¨æœåŠ¡

[5/7] æ£€æŸ¥APIè·¯ç”±...
  âœ“ APIè·¯ç”±

[6/7] æ£€æŸ¥é…ç½®...
  âœ“ é…ç½®åŠ è½½æˆåŠŸ
    - æ•°æ®åº“: postgresql://postgres...
    - Redis: redis://localhost:6379/0

[7/7] æ£€æŸ¥ä¸»åº”ç”¨...
  âœ“ FastAPIåº”ç”¨
    - åº”ç”¨åç§°: çµé²œå¥½ç‰© API
    - ç‰ˆæœ¬: 1.0.0

============================================================
éªŒè¯ç»“æœ: 14 é€šè¿‡, 0 å¤±è´¥
============================================================

âœ… æ‰€æœ‰å¯¼å…¥æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å¯åŠ¨åç«¯æœåŠ¡äº†ã€‚
```

### 2. ä¿®å¤è„šæœ¬

**fix-imports.bat**
- è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤ `merchant.py` çš„å¯¼å…¥é—®é¢˜
- æ£€æŸ¥æ‰€æœ‰ä¾èµ–æ˜¯å¦å·²å®‰è£…
- å®‰è£…ç¼ºå¤±çš„ä¾èµ–
- è¿è¡ŒéªŒè¯è„šæœ¬ç¡®è®¤ä¿®å¤æˆåŠŸ

**ä½¿ç”¨æ–¹æ³•**:
```bash
fix-imports.bat
```

**ç‰¹ç‚¹**:
- è‡ªåŠ¨åŒ–æ£€æµ‹å’Œä¿®å¤
- æ™ºèƒ½ä¾èµ–æ£€æŸ¥
- éªŒè¯ä¿®å¤ç»“æœ
- å‹å¥½çš„é”™è¯¯æç¤º

---

## å¯åŠ¨æµç¨‹æ›´æ–°

### æ›´æ–°åçš„å¯åŠ¨æµç¨‹

```bash
# æ­¥éª¤1: æ£€æŸ¥ç¯å¢ƒï¼ˆå¯é€‰ï¼‰
check-env.bat

# æ­¥éª¤2: å¯åŠ¨DockeræœåŠ¡
start-all.bat

# æ­¥éª¤3: ä¿®å¤å¯¼å…¥é—®é¢˜ â­æ–°å¢
fix-imports.bat

# æ­¥éª¤4: å®‰è£…åç«¯ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
fix-backend.bat

# æ­¥éª¤5: å®‰è£…å‰ç«¯ä¾èµ–
fix-frontend.bat

# æ­¥éª¤6: å¯åŠ¨å„æœåŠ¡
start-backend.bat    # ç»ˆç«¯1
start-mini.bat       # ç»ˆç«¯2
start-merchant.bat   # ç»ˆç«¯3
start-admin.bat      # ç»ˆç«¯4
```

### å¢å¼ºçš„å¯åŠ¨è„šæœ¬

**start-backend.bat** æ–°å¢åŠŸèƒ½:
- âœ… å¯åŠ¨å‰è¿è¡Œå¯¼å…¥éªŒè¯
- âœ… æ£€æŸ¥æ•°æ®åº“è¿æ¥
- âœ… æ£€æŸ¥PostgreSQLçŠ¶æ€
- âœ… æ›´è¯¦ç»†çš„é”™è¯¯æç¤º

**æ‰§è¡Œæµç¨‹**:
```
1. æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒæ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥ä¾èµ–æ˜¯å¦å·²å®‰è£…
3. è¿è¡Œå¯¼å…¥éªŒè¯è„šæœ¬ â­æ–°å¢
4. æ£€æŸ¥PostgreSQLè¿æ¥
5. å¯åŠ¨FastAPIæœåŠ¡
```

---

## è„šæœ¬æ¸…å•

| è„šæœ¬ | åŠŸèƒ½ | ç”¨é€” |
|-----|------|------|
| `check-env.bat` | ç¯å¢ƒæ£€æŸ¥ | æ£€æŸ¥Dockerã€Pythonã€Node.jsç­‰ |
| `fix-imports.bat` | ä¿®å¤å¯¼å…¥é—®é¢˜ | ä¿®å¤æ¨¡å‹å¯¼å…¥å’Œå®‰è£…ä¾èµ– â­æ–°å¢ |
| `fix-backend.bat` | å®‰è£…åç«¯ä¾èµ– | å®‰è£…æ‰€æœ‰Pythonä¾èµ– |
| `fix-frontend.bat` | å®‰è£…å‰ç«¯ä¾èµ– | å®‰è£…æ‰€æœ‰å‰ç«¯ä¾èµ– |
| `start-backend.bat` | å¯åŠ¨åç«¯ | å¢å¼ºçš„åç«¯å¯åŠ¨è„šæœ¬ï¼ˆå«éªŒè¯ï¼‰ |
| `start-mini.bat` | å¯åŠ¨ç”¨æˆ·ç«¯å°ç¨‹åº | ç”¨æˆ·ç«¯å°ç¨‹åºå¼€å‘æœåŠ¡ |
| `start-merchant.bat` | å¯åŠ¨å•†å®¶ç«¯å°ç¨‹åº | å•†å®¶ç«¯å°ç¨‹åºå¼€å‘æœåŠ¡ |
| `start-admin.bat` | å¯åŠ¨ç®¡ç†åå° | PCç®¡ç†åå°å¼€å‘æœåŠ¡ |
| `start-all.bat` | å¯åŠ¨DockeræœåŠ¡ | PostgreSQLã€Redisã€MinIO |
| `stop-all.bat` | åœæ­¢æ‰€æœ‰æœåŠ¡ | åœæ­¢Dockerå®¹å™¨ |

---

## æ•…éšœæ’æŸ¥æŒ‡å—

### é—®é¢˜1: åç«¯å¯åŠ¨å¤±è´¥ - ç¼ºå°‘æ¨¡å—

**ç—‡çŠ¶**: `ModuleNotFoundError: No module named 'xxx'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹å¼1: ä½¿ç”¨ä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰
fix-backend.bat

# æ–¹å¼2: ä½¿ç”¨å¯¼å…¥ä¿®å¤è„šæœ¬
fix-imports.bat

# æ–¹å¼3: æ‰‹åŠ¨å®‰è£…
cd backend
venv\Scripts\activate.bat
pip install -r requirements.txt
```

### é—®é¢˜2: åç«¯å¯åŠ¨å¤±è´¥ - å¯¼å…¥é”™è¯¯

**ç—‡çŠ¶**: `NameError: name 'xxx' is not defined`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨å¯¼å…¥ä¿®å¤è„šæœ¬
fix-imports.bat

# æˆ–è¿è¡ŒéªŒè¯è„šæœ¬æŸ¥çœ‹è¯¦ç»†é”™è¯¯
python scripts/verify-imports.py
```

### é—®é¢˜3: éªŒè¯è„šæœ¬æŠ¥å‘Šé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æŸ¥çœ‹éªŒè¯è„šæœ¬çš„è¯¦ç»†è¾“å‡º
2. æ ¹æ®æç¤ºå®‰è£…ç¼ºå¤±çš„ä¾èµ–
3. æ£€æŸ¥æ¨¡å‹æ–‡ä»¶çš„å¯¼å…¥è¯­å¥
4. å‚è€ƒé”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜

---

## å¿«é€Ÿè¯Šæ–­æµç¨‹

### è¯Šæ–­æ­¥éª¤

```bash
# 1. æ£€æŸ¥ç¯å¢ƒ
check-env.bat

# 2. ä¿®å¤å¯¼å…¥é—®é¢˜
fix-imports.bat

# 3. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¿è¡Œè¯¦ç»†éªŒè¯
python scripts/verify-imports.py

# 4. æŸ¥çœ‹éªŒè¯ç»“æœï¼Œæ ¹æ®æç¤ºä¿®å¤
```

### å¸¸è§ä¿®å¤æ–¹æ³•

| é—®é¢˜ç±»å‹ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|
| ç¼ºå°‘asyncpg | è¿è¡Œ `fix-backend.bat` |
| ç¼ºå°‘minio | è¿è¡Œ `fix-backend.bat` |
| ç¼ºå°‘redis | è¿è¡Œ `fix-backend.bat` |
| relationshipæœªå®šä¹‰ | è¿è¡Œ `fix-imports.bat` |
| å…¶ä»–å¯¼å…¥é”™è¯¯ | æŸ¥çœ‹éªŒè¯è„šæœ¬è¾“å‡º |

---

## éªŒè¯æ¸…å•

å¯åŠ¨å‰è¯·ç¡®è®¤ï¼š

- [ ] Docker Desktopå·²å¯åŠ¨
- [ ] Python 3.10+å·²å®‰è£…
- [ ] Node.js 18+å·²å®‰è£…
- [ ] è¿è¡Œäº† `check-env.bat` æ— é”™è¯¯
- [ ] è¿è¡Œäº† `start-all.bat` å¯åŠ¨DockeræœåŠ¡
- [ ] è¿è¡Œäº† `fix-imports.bat` ä¿®å¤å¯¼å…¥
- [ ] è¿è¡Œäº† `verify-imports.py` éªŒè¯é€šè¿‡
- [ ] PostgreSQLå®¹å™¨æ­£åœ¨è¿è¡Œ
- [ ] Rediså®¹å™¨æ­£åœ¨è¿è¡Œ
- [ ] MinIOå®¹å™¨æ­£åœ¨è¿è¡Œ

---

## æ›´æ–°æ—¶é—´

- **2026-01-27**: åˆå§‹ç‰ˆæœ¬
  - ä¿®å¤asyncpgç¼ºå¤±é—®é¢˜
  - ä¿®å¤relationshipå¯¼å…¥é—®é¢˜
  - åˆ›å»ºéªŒè¯è„šæœ¬
  - åˆ›å»ºä¿®å¤è„šæœ¬
  - æ›´æ–°å¯åŠ¨æµç¨‹

---

## ç›¸å…³æ–‡æ¡£

- **å¿«é€Ÿå¼€å§‹**: `QUICKSTART.md` - å·²æ›´æ–°
- **å®‰è£…æŒ‡å—**: `INSTALLATION_GUIDE.md`
- **æ•…éšœæ’æŸ¥**: `docs/TROUBLESHOOTING.md`
- **éªŒè¯è„šæœ¬**: `scripts/verify-imports.py`

---

**æ‰€æœ‰å·²çŸ¥é—®é¢˜å·²ä¿®å¤ï¼** ğŸ‰

ç°åœ¨å¯ä»¥æ­£å¸¸è¿è¡Œ `fix-imports.bat` ç„¶åå¯åŠ¨åç«¯æœåŠ¡äº†ã€‚
