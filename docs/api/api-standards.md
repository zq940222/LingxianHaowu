# API接口设计规范

## 一、通用规范

### 1.1 URL规范
- 基础路径: `/api/v1`
- 使用小写字母
- 使用连字符(-)分隔单词
- 使用名词复数形式

```
GET    /api/v1/products          # 获取商品列表
POST   /api/v1/orders            # 创建订单
GET    /api/v1/orders/{id}       # 获取订单详情
PUT    /api/v1/orders/{id}       # 更新订单
DELETE /api/v1/orders/{id}       # 删除订单
```

### 1.2 HTTP方法
| 方法 | 描述 | 幂等性 |
|------|------|--------|
| GET | 获取资源 | 是 |
| POST | 创建资源 | 否 |
| PUT | 更新资源(全量) | 是 |
| PATCH | 更新资源(部分) | 否 |
| DELETE | 删除资源 | 是 |

### 1.3 统一响应格式

#### 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1640000000
}
```

#### 失败响应
```json
{
  "code": 400,
  "message": "参数错误",
  "data": null,
  "timestamp": 1640000000,
  "errors": {
    "field_name": "错误详情"
  }
}
```

### 1.4 分页响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [],
    "total": 100,
    "page": 1,
    "size": 20,
    "pages": 5
  },
  "timestamp": 1640000000
}
```

### 1.5 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 201 | 创建成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 409 | 资源冲突 |
| 429 | 请求过多 |
| 500 | 服务器内部错误 |

### 1.6 业务错误码

| 错误码 | 说明 |
|--------|------|
| 1000 | 未知错误 |
| 1001 | 用户不存在 |
| 1002 | 用户已被禁用 |
| 1003 | 密码错误 |
| 1004 | Token无效或已过期 |
| 1005 | 权限不足 |
| 2001 | 商品不存在 |
| 2002 | 商品库存不足 |
| 2003 | 商品已下架 |
| 3001 | 订单不存在 |
| 3002 | 订单状态不允许此操作 |
| 3003 | 订单已支付 |
| 3004 | 订单已取消 |
| 4001 | 支付失败 |
| 4002 | 支付金额不匹配 |
| 4003 | 支付超时 |
| 5001 | 拼团不存在 |
| 5002 | 拼团已满员 |
| 5003 | 拼团已过期 |
| 6001 | 积分不足 |
| 6002 | 今日已签到 |
| 7001 | 优惠券不存在 |
| 7002 | 优惠券已过期 |
| 7003 | 优惠券已使用 |

## 二、认证授权

### 2.1 JWT认证
- 请求头: `Authorization: Bearer {token}`
- Token过期时间: 7天
- 刷新Token机制

### 2.2 认证接口
```
POST /api/v1/auth/login
POST /api/v1/auth/refresh
POST /api/v1/auth/logout
```

## 三、数据类型

### 3.1 基础类型
```json
{
  "string": "字符串",
  "number": 123,
  "boolean": true,
  "null": null,
  "array": [],
  "object": {}
}
```

### 3.2 时间格式
- 统一使用ISO 8601格式
- 时区: UTC+8 (北京时间)
- 示例: `2024-01-01T12:00:00+08:00`

### 3.3 金额格式
- 使用DECIMAL类型
- 保留2位小数
- 示例: `99.99`

## 四、接口文档

### 4.1 接口说明模板
```markdown
### 接口名称
**接口描述**: 简要描述接口功能

**请求方式**: GET/POST/PUT/DELETE

**请求路径**: `/api/v1/path`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | integer | 是 | ID |

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1640000000
}
```
```

## 五、安全规范

### 5.1 签名验证
- 微信支付回调需要验证签名
- 使用HMAC-SHA256算法

### 5.2 接口限流
- 使用Redis实现滑动窗口
- 默认限制: 每分钟100次请求

### 5.3 数据验证
- 使用Pydantic进行参数验证
- 所有外部输入必须验证

## 六、版本管理

### 6.1 版本策略
- URL路径包含版本号: `/api/v1/`
- 不兼容升级创建新版本: `/api/v2/`
- 向后兼容修改不升级版本

### 6.2 废弃通知
- 废弃接口返回`Warning`响应头
- 提前3个月通知废弃
